<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Upload Excel</title>

<style>
body { font-family: Arial; max-width: 600px; margin: 40px auto; }
#spinner { display: none; font-size: 18px; }
#download-btn { display: none; margin-top: 20px; }
</style>

</head>
<body>

<h2>Upload Excel File</h2>

<form id="uploadForm">
    <input type="file" name="file" id="fileInput" accept=".xlsx,.xls" required>
    <br><br>
    <button type="submit">Upload & Process</button>
</form>

<div id="spinner">⏳ Processing... This may take 2–3 minutes.</div>

<button id="download-btn">Download PDF</button>

<script>
const form = document.getElementById('uploadForm');
const spinner = document.getElementById('spinner');
const downloadBtn = document.getElementById('download-btn');

let jobId = null;
let checkInterval = null;

form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const fileInput = document.getElementById('fileInput');
    const formData = new FormData();
    formData.append("file", fileInput.files[0]);

    spinner.style.display = "block";

    const res = await fetch('/upload', {
        method: 'POST',
        body: formData
    });

    const data = await res.json();
    jobId = data.job_id;

    // check status every 5 seconds
    checkInterval = setInterval(checkStatus, 5000);
});

async function checkStatus() {
    const res = await fetch('/status/' + jobId);
    const data = await res.json();

    if (data.ready) {
        clearInterval(checkInterval);
        spinner.innerHTML = "✔ PDF is ready!";
        downloadBtn.style.display = "inline-block";

        downloadBtn.onclick = () => {
            window.location.href = '/download/' + jobId;
        };
    }

    if (data.error) {
        clearInterval(checkInterval);
        spinner.innerHTML = "❌ Error occurred during processing.";
    }
}
</script>

</body>
</html>
